import React, { useState } from "react";
import { motion } from "framer-motion";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";

// --- Bird data setup (future-proofed for filtering) ---
const birds = [
  {
    name: "European Robin",
    color: "#E25822",
    region: "Europe",
    habitat: "forest",
  },
  {
    name: "Blue Jay",
    color: "#3A75C4",
    region: "North America",
    habitat: "forest",
  },
  {
    name: "Great Tit",
    color: "#E5E500",
    region: "Europe",
    habitat: "garden",
  },
  {
    name: "Blackbird",
    color: "#111111",
    region: "Europe",
    habitat: "forest",
  },
  {
    name: "Barn Owl",
    color: "#F5E6C5",
    region: "Europe",
    habitat: "open fields",
  },
  {
    name: "Red Cardinal",
    color: "#C41E3A",
    region: "North America",
    habitat: "woodland",
  },
  {
    name: "Magpie",
    color: "#FFFFFF",
    region: "Europe",
    habitat: "urban",
  },
  {
    name: "Goldfinch",
    color: "#FFD700",
    region: "Europe",
    habitat: "meadows",
  },
  {
    name: "Kingfisher",
    color: "#00BFFF",
    region: "Europe",
    habitat: "water",
  },
  {
    name: "Sparrow",
    color: "#8B5A2B",
    region: "Europe",
    habitat: "urban",
  },
];

export default function BirdWatcher() {
  const [bird, setBird] = useState(null);
  const [journal, setJournal] = useState([]);
  const [showJournal, setShowJournal] = useState(false);

  // --- Pick a random bird ---
  const getRandomBird = () => {
    const randomBird = birds[Math.floor(Math.random() * birds.length)];
    setBird(randomBird);
    if (!journal.find((b) => b.name === randomBird.name)) {
      setJournal([...journal, randomBird]);
    }
  };

  // --- Utility: check color brightness ---
  const isLightColor = (color) => {
    const hex = color.replace("#", "");
    const r = parseInt(hex.substring(0, 2), 16);
    const g = parseInt(hex.substring(2, 4), 16);
    const b = parseInt(hex.substring(4, 6), 16);
    const brightness = (r * 299 + g * 587 + b * 114) / 1000;
    return brightness > 200;
  };

  // --- Style: adjust text color & outline ---
  const getTextColorStyle = (color) => {
    if (isLightColor(color)) {
      return {
        color: color,
        textShadow: "0 0 2px #000, 0 0 4px #000",
      };
    }
    return { color };
  };

  // --- Style: tint background softly based on bird color ---
  const getCardStyle = (color) => {
    const light = isLightColor(color);
    return {
      backgroundColor: light
        ? "#f4f4f4"
        : `${color}20`, // semi-transparent tint of main color
      borderColor: `${color}60`,
    };
  };

  return (
    <div className="flex flex-col items-center justify-center min-h-screen gap-6 p-4 bg-gradient-to-b from-sky-200 to-sky-500">
      <motion.div
        key={bird ? bird.name : "empty"}
        initial={{ opacity: 0, scale: 0.95 }}
        animate={{ opacity: 1, scale: 1 }}
        transition={{ duration: 0.4 }}
      >
        <Card
          className="w-80 h-80 flex items-center justify-center shadow-xl rounded-2xl border-2"
          style={bird ? getCardStyle(bird.color) : {}}
        >
          <CardContent className="text-center">
            {bird ? (
              <>
                <motion.img
                  src={`/birds/${bird.name.replace(/\s+/g, "_")}.jpg`}
                  alt={bird.name}
                  className="mx-auto rounded-xl w-64 h-48 object-cover"
                  initial={{ scale: 1 }}
                  animate={{ scale: [1, 1.02, 1] }}
                  transition={{
                    duration: 3,
                    repeat: Infinity,
                    repeatType: "mirror",
                  }}
                />
                <h2
                  className="mt-4 text-2xl font-bold"
                  style={getTextColorStyle(bird.color)}
                >
                  {bird.name}
                </h2>
              </>
            ) : (
              <p className="text-gray-500">Press Spot Bird to Begin</p>
            )}
          </CardContent>
        </Card>
      </motion.div>

      <div className="flex gap-4">
        <Button onClick={getRandomBird}>Spot Bird</Button>
        <Button variant="outline" onClick={() => setShowJournal(!showJournal)}>
          {showJournal ? "Hide Journal" : "Show Journal"}
        </Button>
      </div>

      {showJournal && (
        <motion.div
          initial={{ opacity: 0, height: 0 }}
          animate={{ opacity: 1, height: "auto" }}
          transition={{ duration: 0.4 }}
          className="w-80 mt-4 bg-white/80 rounded-xl shadow-md p-3"
        >
          <h3 className="font-semibold mb-2">Bird Watcher's Journal</h3>
          <ul className="space-y-1">
            {journal.map((b, i) => (
              <li key={i} style={{ color: b.color }}>
                {b.name}
              </li>
            ))}
          </ul>
        </motion.div>
      )}
    </div>
  );
}
